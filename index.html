<!DOCTYPE html>
<html lang="en" style="height:100%">

<head>
    <meta charSet="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="description" content="Artificial intelligence with Mihok from TorontoJS, building on basic knowledge we will discover and build Neural Networks from scratch to get a better understanding of how they work." />
    <title>JS Workshop</title>
    <script type="text/javascript" src="helpers/manifest.lib.js"></script>
    <script type="text/javascript" src="helpers/math.lib.js"></script>
    <script type="text/javascript" src="helpers/data.lib.js"></script>
    <!-- Insert Live Editor here -->
</head>

<body>
  <script type="text/javascript" src="helpers/renderers.lib.js"></script>
  <script type="text/javascript">
    const B1 = 0;
    const B2 = 1;
    const B3 = 2;

    const W1 = 0;
    const W2 = 1;
    const W3 = 2;
    const W4 = 3;
    const W5 = 4;
    const W6 = 5;

    const H1 = 0;
    const H2 = 1;

    const I1 = 0;
    const I2 = 1;

    class Network {
      hidden;
      output;
      biases;
      weights;

      constructor (biases = [], weights = [], activatorFn) {
        this.biases = biases;
        this.weights = weights;

        // Distribute the six weights between the first hidden layer, the
        // second one, and the output layer
        const h1Weights = [ this.weights[W1], this.weights[W2] ]
        const h2Weights = [ this.weights[W3], this.weights[W4] ]
        const o1Weights = [ this.weights[W5], this.weights[W6] ]

        this.hidden = [
          new Neuron(biases[B1], h1Weights, activatorFn),
          new Neuron(biases[B2], h2Weights, activatorFn),
        ];

        this.output = new Neuron(biases[B3], o1Weights, activatorFn);
      }

      reload () {
        // First hidden layer/neuron
        this.hidden[H1].weights = [
          this.weights[W1],
          this.weights[W2],
        ];

        this.hidden[H1].bias = this.biases[B1];

        // Second hidden layer/neuron
        this.hidden[H2].weights = [
          this.weights[W3],
          this.weights[W4],
        ];

        this.hidden[H2].bias = this.biases[B2];

        // Output layer/neuron
        this.output.weights = [
          this.weights[W5],
          this.weights[W6],
        ];

        this.output.bias = this.biases[B3];
      }

      query (inputs = []) {
        let params = [];

        for (let h = 0; h < this.hidden.length; h++) {
          params.push(this.hidden[h].activate(inputs));
        }

        return this.output.activate(params);
      }
    }

    // Neuron
    class Neuron {
      bias;
      weights;
      activatorFn = function (x) {
        throw new Error('Not implemented')
      }

      constructor ( bias = 0, weights = [], activatorFn) {
        // TODO: error checking
        this.bias = bias;
        this.weights = weights;
        this.activatorFn = activatorFn;
      }

      sum (inputs = []) {
        let output = 0;
        let buffer = [];

        for (let i = 0; i < inputs.length; i++) {
          buffer[i] = inputs[i] * this.weights[i];
        }

        for (let b = 0; b < buffer.length; b++) {
          output = output + buffer[b]
        }

        output = output + this.bias;

        return output;
      }

      activate (inputs = []) {
        let output = this.sum(inputs);

        let result = this.activatorFn(output);

        return result;
      }
    }

    const b = [0, 0, 0];
    const w = [1, 1, 1, 1, 1, 1];

    const nn = new Network(b, w, Math.sigmoid);

    console.log('Run neural network against inputs');
    console.log(nn.query([2, 3]));
  </script>
</body>

</html>
